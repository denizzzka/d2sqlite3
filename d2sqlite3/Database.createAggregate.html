<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Function Database.createAggregate</title>
		<link rel="stylesheet" href="../css/style.min.css"/>
		<script type="text/javascript" src="../js/script.min.js"></script>
	</head>
	<body onload="setupDdox();">
		<header>
		</header>
		<nav id="main-nav">
				<noscript>
					<p style="color: red">The search functionality needs JavaScript enabled</p>
				</noscript>
				<div id="symbolSearchPane" style="display: none">
					<input id="symbolSearch" type="text" placeholder="Search" onchange="performSymbolSearch(24);" onkeypress="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();" autofocus="autofocus"/>
					<ul id="symbolSearchResults" style="display: none"></ul>
					<script type="application/javascript" src="../symbols.js"></script>
					<script type="application/javascript">
var symbolSearchRootDir = "../";
document.getElementById('symbolSearchPane').style.display = 'block';
					</script>
				</div>
						<ul class="tree-view">
							<li>
								<a href="../d2sqlite3.html" class="selected module">d2sqlite3</a>
							</li>
						</ul>
			<p id="main-nav-footer">
 Built with
				<a href="https://github.com/MartinNowak/scod">scod</a>
			</p>
		</nav>
		<div id="main-contents">
			<h1>Function Database.createAggregate</h1>
			<section>
				<p>Creates and registers a new aggregate function in the database.
</p>
<section></section>

					<section>
						<h3>Prototype</h3>
						<div class="prototype">
							<code class="lang-d">
<span class="typ">void</span> <span class="pln">createAggregate</span><span class="pun">(</span><span class="pln">T</span><span class="pun">)</span><span class="pun">(</span>
								<br/>
&nbsp;&nbsp;<span class="typ">string</span> <span class="pln">name</span><span class="pun">,</span>
								<br/>
&nbsp;&nbsp;<span class="pln">T</span> <span class="pln">agg</span><span class="pun">,</span>
								<br/>
&nbsp;&nbsp;<a href="../d2sqlite3/Deterministic.html"><span class="typ">Deterministic</span></a> <span class="pln">det</span> <span class="pun">=</span> <span class="typ">Deterministic<wbr/></span><span class="pun">.</span><span class="pln">yes</span>
								<br/>
<span class="pun">)</span><span class="pun">;</span>
							</code>
						</div>
					</section>
<section><h3>Parameters</h3>
<table><col class="caption"><tr><th>Name</th><th>Description</th></tr>
<tr><td id="name">name</td><td> The <a href="../d2sqlite3/Database.createAggregate.html#name"><code class="lang-d"><span class="pln">name</span></code></a> that the aggregate function will have in the database.
</td></tr>
<tr><td id="agg">agg</td><td> The struct of type T implementing the aggregate. T must implement
        at least these two methods: <code class="lang-d">accumulate()</code> and <code class="lang-d">result()</code>.
        Each parameter and the returned type of <code class="lang-d">accumulate()</code> and <code class="lang-d">result()</code> must be
        a boolean or numeric type, a string, an array, <code class="lang-d">null</code>, or a <code class="lang-d">Nullable!T</code>
        where T is any of the previous types. These methods cannot be variadic.
</td></tr>
<tr><td id="det">det</td><td> Tells SQLite whether the result of the function is deterministic, i.e. if the
        result is the same when called with the same parameters. Recent versions of SQLite
        perform optimizations based on this. Set to <code class="lang-d"><a href="../d2sqlite3/Deterministic.no.html"><span class="typ">Deterministic<wbr/></span><span class="pun">.</span><span class="pln">no</span></a></code> otherwise.</td></tr>
</table>
</section>
<section><h3>See Also</h3>
<p><a href="http://www.sqlite.org/c3ref/create_function.html">http://www.sqlite.org/c3ref/create_function.html</a>.
</p>
</section>
<section><h3>Example</h3>
<pre class="code"><code class="lang-d"><span class="kwd">import </span><span class="pln">std<wbr/></span><span class="pun">.</span><span class="pln">array </span><span class="pun">: </span><span class="pln">appender</span><span class="pun">, </span><span class="pln">join</span><span class="pun">;

</span><span class="com">// The implementation of the aggregate function
</span><span class="kwd">struct </span><span class="typ">Joiner
</span><span class="pun">{
    </span><span class="kwd">private
    </span><span class="pun">{
        </span><span class="typ">Appender</span><span class="pun">!(</span><span class="typ">string</span><span class="pun">[]) </span><span class="pln">stringList</span><span class="pun">;
        </span><span class="typ">string </span><span class="pln">separator</span><span class="pun">;
    }

    </span><span class="kwd">this</span><span class="pun">(</span><span class="typ">string </span><span class="pln">separator</span><span class="pun">)
    {
        </span><span class="kwd">this<wbr/></span><span class="pun">.</span><span class="pln">separator </span><span class="pun">= </span><span class="pln">separator</span><span class="pun">;
    }

    </span><span class="typ">void </span><span class="pln">accumulate</span><span class="pun">(</span><span class="typ">string </span><span class="pln">word</span><span class="pun">)
    {
        </span><span class="pln">stringList<wbr/></span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">word</span><span class="pun">);
    }

    </span><span class="typ">string </span><span class="pln">result</span><span class="pun">()
    {
        </span><span class="kwd">return </span><span class="pln">stringList<wbr/></span><span class="pun">.</span><span class="pln">data<wbr/></span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">separator</span><span class="pun">);
    }
}

</span><span class="kwd">auto </span><span class="pln">db </span><span class="pun">= <a href="../d2sqlite3/Database.html"></span><span class="typ">Database</a></span><span class="pun">(</span><span class="str">":memory:"</span><span class="pun">);
</span><span class="pln">db<wbr/></span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="str">"CREATE TABLE test (word TEXT);
        INSERT INTO test VALUES ('My');
        INSERT INTO test VALUES ('cat');
        INSERT INTO test VALUES ('is');
        INSERT INTO test VALUES ('black');"</span><span class="pun">);

</span><span class="pln">db<wbr/></span><span class="pun">.</span><span class="pln">createAggregate</span><span class="pun">(</span><span class="str">"dash_join"</span><span class="pun">, </span><span class="typ">Joiner</span><span class="pun">(</span><span class="str">"-"</span><span class="pun">));
</span><span class="kwd">auto </span><span class="pln">text </span><span class="pun">= </span><span class="pln">db<wbr/></span><span class="pun">.</span><span class="pln">execute</span><span class="pun">(</span><span class="str">"SELECT dash_join(word) FROM test"</span><span class="pun">)<wbr/>.</span><span class="pln">oneValue</span><span class="pun">!</span><span class="typ">string</span><span class="pun">;
</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">text </span><span class="pun">== </span><span class="str">"My-cat-is-black"</span><span class="pun">);

</span></code></pre>
</section>

			</section>
			<footer>
				<hr/>
				<div id="license-info">
<p>Nicolas Sicard (biozic) and other contributors at <a href="https://github.com/biozic/d2sqlite3">https://github.com/biozic/<code class="lang-d"><span class="pln">d2sqlite3</span></code></a>
</p>

<p>Copyright 2011-16 Nicolas Sicard.
</p>

<p><a href="http://www.boost.org/LICENSE_1_0.txt">Boost License 1.0</a>.
</p>

				</div>
			</footer>
		</div>
	</body>
</html>